@model IEnumerable<ReadItemRuntime>
@inject IOptions<AdminOptions> _config
@{
    ViewData["Title"] = "所有的阅读";
}

<div class="row">
    <div class="col-lg-5 mb-3">
        <div class="bg-light p-1">
            <canvas id="read_stats"></canvas>
        </div>
    </div>
    <div class="col-lg-7">
        <div class="table-responsive">
            <table class="table caption-top align-middle table-bordered text-center">
                <caption>阅读总数: @Model.Count() <a href="/read/add" class="btn btn-info float-end"><i class="fas fa-plus"></i> 添加新的阅读</a></caption>
                <thead class="table-light">
                <tr>
                    <th scope="col" class="text-start">书名</th>
                    <th scope="col">开始时间</th>
                    <th scope="col">状态</th>
                    <th scope="col">操作</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <th class="text-start">@item.Raw.BookName @Html.Raw(!item.Raw.IsPublished ? "<i class='fas fa-eye-slash text-danger' title='未发布'></i>" : "")</th>
                        <th>@item.Raw.StartTime.ToChinaDate()</th>
                        <th>@Html.Raw(item.Raw.IsCompleted ? "<i class='fas fa-check text-success' title='阅读完成'></i>" : "<i class='fas fa-book-reader text-info' title='正在阅读'></i>")</th>
                        <th>
                            <a class="btn btn-info me-2" href="/read/@item.Raw.Id/update"><i class="fas fa-edit"></i> 编辑</a>
                            <a class="btn btn-danger" href="javascript:;" onclick="deleteBookItem('@item.Raw.Id')"><i class="fas fa-trash-alt"></i> 删除</a>
                        </th>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>


@section Scripts{
    <script>
        activeNavItem("#nav_read");

        function deleteBookItem(id) {
            submitRequest(`/read/${id}`,
                {
                    method: "DELETE",
                    okAction: function() {
                        window.location.reload(true);
                    }
                });
        }

        submitRequest("/read/stats",
            {
                okAction: function(chart) {
                    createChart(document.querySelector("#read_stats"), chart);
                }
            });
    </script>
}